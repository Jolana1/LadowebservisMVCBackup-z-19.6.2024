@using LadowebservisMVC.Models
@model MemberModel

@{
    ViewBag.Title = "member";

    // Prefer the strongly-typed model, then ViewBag, then Session stored model.
    var member = Model ?? (ViewBag.Member as MemberModel) ?? (Session != null ? Session["MemberModel"] as MemberModel : null);

    // If still null but the user is authenticated, create a minimal model and fill a likely name property.
    if (member == null && User?.Identity?.IsAuthenticated == true)
    {
        member = new MemberModel();

        // Try to set a username/display name property if one exists.
        var memberType = member.GetType();
        var nameProp = memberType.GetProperty("UserName")
                       ?? memberType.GetProperty("Username")
                       ?? memberType.GetProperty("Name")
                       ?? memberType.GetProperty("DisplayName");

        if (nameProp != null && nameProp.CanWrite)
        {
            nameProp.SetValue(member, User.Identity.Name);
        }
    }
}

<div class="container card pt-4">
    <div class="row justify-content-center">
        <div class="col-12 col-sm-10 col-md-8">
            @*<div class="card p-4">*@
            <h1 class="h4 text-center text-success">VITAJTE, STE PRIHLÁSENÝ!</h1>

            @if (member != null)
            {
                <div class="well text-left" style="background: rgba(255,255,255,0.04); padding: 1rem; margin-top: 1rem; color: #5d33fb;">
                    <h4>Informácie o členovi</h4>
                    <dl class="dl-horizontal">
                        @foreach (var prop in member.GetType().GetProperties(System.Reflection.BindingFlags.Public | System.Reflection.BindingFlags.Instance))
                        {
                            <dt>@prop.Name:</dt>
                            <dd>@Html.Encode((prop.GetValue(member, null) ?? "").ToString())</dd>
                        }
                    </dl>
                </div>
            }
            else
            {
                <div class="alert alert-info mt-3">
                    Informácie o členovi nie sú momentálne dostupné. Skúste sa znova prihlásiť alebo obnoviť stránku.
                </div>
            }

            <p class="mt-3">
                Pri 1. objednávke a novej registrácii použite kupón <strong>FRIENDS25</strong> a získate 10% zľavu!<br />
                Ako zaregistrovaný zákazník získavate aj tieto výhody:
            </p>

            <ul>
                <li>Rýchlejší nákup vďaka vlastnému zoznamu obľúbených položiek.</li>
                <li>Možnosť byť informovaný o novinkách a akciách.</li>
                <li>Prístup do pripravovaného vernostného a zľavového programu.</li>
                <li>Možnosť sledovať históriu objednávok a zľavových kódov.</li>
            </ul>

            <div class="text-center my-3">
                <a class="btn btn-primary btn-md tlacitko-moje" href='@Url.Action("Memberinfo","Home")' title="Profil užívateľa">Vstúpte do členskej sekcie</a>
            </div>

            @using (Html.BeginForm("Login", "Home", FormMethod.Post, new { @class = "form-horizontal text-center" }))
            {
                <div class="form-group">
                    <button type="submit" class="btn btn-danger">Odhlásiť</button>
                </div>
            }

        </div>
    </div>
</div>
